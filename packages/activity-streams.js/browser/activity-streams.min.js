!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.ActivityStreams=t()}}(function(){return function t(e,r,i){function n(s,c){if(!r[s]){if(!e[s]){var f="function"==typeof require&&require;if(!c&&f)return f(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var a=r[s]={exports:{}};e[s][0].call(a.exports,function(t){var r=e[s][1][t];return n(r?r:t)},a,a.exports,t,e,r,i)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s]);return n}({1:[function(t,e,r){function i(t,e){for(var r=Object.keys(e),i=r.length-1;i>=0;i-=1)if(u[t].indexOf(r[i])<0)if(l[r[i]])e[l[r[i]]]=e[r[i]],delete e[r[i]];else{if(e["@type"]&&"object"==typeof a[e["@type"]]&&a[e["@type"]].indexOf(r[i])>=0)continue;if(f.indexOf(e["@type"])<0)return'invalid property: "'+r[i]+'"'}return!1}var n=t("event-emitter"),o=t("array-keys"),s=new o({identifier:"@id"}),c=n(),f=[],u={stream:["@id","@type","actor","target","object","@context","context","published","error"],object:["@id","@type","@context","alias","attachedTo","attachment","attributedTo","attributedWith","content","context","contextOf","displayName","endTime","generator","generatorOf","icon","image","inReplyTo","memberOf","location","locationOf","objectOf","originOf","presence","preview","previewOf","provider","providerOf","published","rating","resultOf","replies","scope","scopeOf","startTime","status","summary","tag","tagOf","targetOf","title","updated","url","titleMap","contentMap","members"]},a={},l={id:"@id",verb:"@type",objectType:"@type",platform:"context"},p={actor:{primary:"@id",props:u},target:{primary:"@id",props:u},object:{primary:"content",props:u}},h=Object.keys(p),d=function(t){var e={},r=i("stream",t);if(r)throw new Error(r);if("object"==typeof t.object&&(r=i("object",t.object)))throw new Error(r);for(var n in t)if("string"==typeof t[n])e[n]=s.getRecord(t[n])||t[n];else if(Array.isArray(t[n]))for(e[n]=[],o=t[n].length-1;o>=0;o-=1)"string"==typeof t[n][o]&&(e[n][o]=s.getRecord(t[n][o])||t[n][o]);else e[n]=t[n];for(var o=h.length-1;o>=0;o-=1)if("string"==typeof e[h[o]]){var f=p[h[o]].primary,u={};u[f]=e[h[o]],e[h[o]]=u}return c.emit("activity-stream",e),e},y={create:function(t){var e=!1,r=i("object",t);if(r)throw new Error(r);try{e=s.addRecord(t)}catch(t){throw new Error(t)}return e&&c.emit("activity-object-create",t),e},delete:function(t){var e=s.removeRecord(t);return e&&c.emit("activity-object-delete",t),e},get:function(t){var e=s.getRecord(t);return e?e:t},list:function(){return s.getIdentifiers()},getByType:function(t){s.forEach(function(t){})}};e.exports=function(t){if("object"==typeof t&&(f=t.specialObjs||[],"object"==typeof t.customProps))for(var e=Object.keys(t.customProps),r=0,i=e.length;r<i;r+=1)if("object"==typeof t.customProps[e[r]]){a[e[r]]=[];for(var n=0,o=t.customProps[e[r]].length;n<o;n+=1)a[e[r]].push(t.customProps[e[r]][n])}return{Stream:d,Object:y,on:function(t,e){return c.on(t,e)},once:function(t,e){return c.once(t,e)},off:function(t,e){return c.off(t,e)}}}},{"array-keys":2,"event-emitter":17}],2:[function(t,e,r){function i(t){"object"!=typeof t&&(t={}),this._identifier=t.identifier||"id",this._store=[],this._idx=[],t.emitEvents?(this._emitEvents=!0,this.events=new n):this._emitEvents=!1}var n=t("tiny-emitter");i.prototype.emitEvent=function(t,e,r){this._emitEvents&&!r&&this.events.emit(t,e)},i.prototype.getIdentifiers=function(){for(var t=[],e=this._store.length-1;e>=0;e-=1)t[t.length]=this._store[e][this._identifier];return t},i.prototype.getRecord=function(t){for(var e=this._store.length-1;e>=0;e-=1)if(this._store[e][this._identifier]===t)return this._store[e]},i.prototype.exists=function(t){return this.getIndex(t)>=0},i.prototype.getIndex=function(t){for(var e=this._idx.length-1;e>=0;e-=1)if(this._idx[e]===t)return e;return-1},i.prototype.addRecord=function(t){if("object"!=typeof t)throw new Error("cannot add non-object records.");if(!t[this._identifier])throw new Error("cannot add a record with no `"+this._identifier+"` property specified.");var e=this.removeRecord(t[this._identifier],!0);return this._idx[this._idx.length]=t[this._identifier],this._store[this._store.length]=t,setTimeout(function(){e?setTimeout(this.emitEvent.bind(this,"update",t),0):setTimeout(this.emitEvent.bind(this,"add",t),0)}.bind(this),0),!0},i.prototype.removeRecord=function(t,e){var r=this.getIndex(t);if(r<0)return!1;for(var i=r;i>=0;i-=1)if(this._store[i]&&this._store[i][this._identifier]===t)return this._store.splice(i,1),this._idx.splice(r,1),setTimeout(this.emitEvent.bind(this,"remove",t,e),0),!0;for(var n=this._store.length-1;n>=r;n-=1)if(this._store[i]&&this._store[n][this._identifier]===t)return this._store.splice(n,1),this._idx.splice(r,1),setTimeout(this.emitEvent.bind(this,"remove",t,e),0),!0;return!1},i.prototype.forEachRecord=function(t){var e=0,r=this,i=function(){};return setTimeout(function(){for(var n=r._store.length-1;n>=0;n-=1)e+=1,setTimeout(t.bind(null,r._store[n],n),0);setTimeout(i.bind(null,e),0)},0),{finally:function(t){i=t}}},i.prototype.mapRecords=function(t){for(var e=0,r=this,i=[],n=r._store.length-1;n>=0;n-=1)e+=1,i.push(t(r._store[n],n));return i},i.prototype.getCount=function(){return this._store.length},i.prototype.removeAll=function(){for(var t=this._store.length-1;t>=0;t-=1)delete this._store[t];this._store=[]},e.exports=i},{"tiny-emitter":18}],3:[function(t,e,r){"use strict";var i,n=t("es5-ext/object/assign"),o=t("es5-ext/object/normalize-options"),s=t("es5-ext/object/is-callable"),c=t("es5-ext/string/#/contains");i=e.exports=function(t,e){var r,i,s,f,u;return arguments.length<2||"string"!=typeof t?(f=e,e=t,t=null):f=arguments[2],null==t?(r=s=!0,i=!1):(r=c.call(t,"c"),i=c.call(t,"e"),s=c.call(t,"w")),u={value:e,configurable:r,enumerable:i,writable:s},f?n(o(f),u):u},i.gs=function(t,e,r){var i,f,u,a;return"string"!=typeof t?(u=r,r=e,e=t,t=null):u=arguments[3],null==e?e=void 0:s(e)?null==r?r=void 0:s(r)||(u=r,r=void 0):(u=e,e=r=void 0),null==t?(i=!0,f=!1):(i=c.call(t,"c"),f=c.call(t,"e")),a={get:e,set:r,configurable:i,enumerable:f},u?n(o(u),a):a}},{"es5-ext/object/assign":4,"es5-ext/object/is-callable":7,"es5-ext/object/normalize-options":11,"es5-ext/string/#/contains":14}],4:[function(t,e,r){"use strict";e.exports=t("./is-implemented")()?Object.assign:t("./shim")},{"./is-implemented":5,"./shim":6}],5:[function(t,e,r){"use strict";e.exports=function(){var t,e=Object.assign;return"function"==typeof e&&(t={foo:"raz"},e(t,{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")}},{}],6:[function(t,e,r){"use strict";var i=t("../keys"),n=t("../valid-value"),o=Math.max;e.exports=function(t,e){var r,s,c,f=o(arguments.length,2);for(t=Object(n(t)),c=function(i){try{t[i]=e[i]}catch(t){r||(r=t)}},s=1;s<f;++s)e=arguments[s],i(e).forEach(c);if(void 0!==r)throw r;return t}},{"../keys":8,"../valid-value":13}],7:[function(t,e,r){"use strict";e.exports=function(t){return"function"==typeof t}},{}],8:[function(t,e,r){"use strict";e.exports=t("./is-implemented")()?Object.keys:t("./shim")},{"./is-implemented":9,"./shim":10}],9:[function(t,e,r){"use strict";e.exports=function(){try{return Object.keys("primitive"),!0}catch(t){return!1}}},{}],10:[function(t,e,r){"use strict";var i=Object.keys;e.exports=function(t){return i(null==t?t:Object(t))}},{}],11:[function(t,e,r){"use strict";var i=Array.prototype.forEach,n=Object.create,o=function(t,e){var r;for(r in t)e[r]=t[r]};e.exports=function(t){var e=n(null);return i.call(arguments,function(t){null!=t&&o(Object(t),e)}),e}},{}],12:[function(t,e,r){"use strict";e.exports=function(t){if("function"!=typeof t)throw new TypeError(t+" is not a function");return t}},{}],13:[function(t,e,r){"use strict";e.exports=function(t){if(null==t)throw new TypeError("Cannot use null or undefined");return t}},{}],14:[function(t,e,r){"use strict";e.exports=t("./is-implemented")()?String.prototype.contains:t("./shim")},{"./is-implemented":15,"./shim":16}],15:[function(t,e,r){"use strict";var i="razdwatrzy";e.exports=function(){return"function"==typeof i.contains&&(i.contains("dwa")===!0&&i.contains("foo")===!1)}},{}],16:[function(t,e,r){"use strict";var i=String.prototype.indexOf;e.exports=function(t){return i.call(this,t,arguments[1])>-1}},{}],17:[function(t,e,r){"use strict";var i,n,o,s,c,f,u,a=t("d"),l=t("es5-ext/object/valid-callable"),p=Function.prototype.apply,h=Function.prototype.call,d=Object.create,y=Object.defineProperty,v=Object.defineProperties,m=Object.prototype.hasOwnProperty,_={configurable:!0,enumerable:!1,writable:!0};i=function(t,e){var r;return l(e),m.call(this,"__ee__")?r=this.__ee__:(r=_.value=d(null),y(this,"__ee__",_),_.value=null),r[t]?"object"==typeof r[t]?r[t].push(e):r[t]=[r[t],e]:r[t]=e,this},n=function(t,e){var r,n;return l(e),n=this,i.call(this,t,r=function(){o.call(n,t,r),p.call(e,this,arguments)}),r.__eeOnceListener__=e,this},o=function(t,e){var r,i,n,o;if(l(e),!m.call(this,"__ee__"))return this;if(r=this.__ee__,!r[t])return this;if(i=r[t],"object"==typeof i)for(o=0;n=i[o];++o)n!==e&&n.__eeOnceListener__!==e||(2===i.length?r[t]=i[o?0:1]:i.splice(o,1));else i!==e&&i.__eeOnceListener__!==e||delete r[t];return this},s=function(t){var e,r,i,n,o;if(m.call(this,"__ee__")&&(n=this.__ee__[t]))if("object"==typeof n){for(r=arguments.length,o=new Array(r-1),e=1;e<r;++e)o[e-1]=arguments[e];for(n=n.slice(),e=0;i=n[e];++e)p.call(i,this,o)}else switch(arguments.length){case 1:h.call(n,this);break;case 2:h.call(n,this,arguments[1]);break;case 3:h.call(n,this,arguments[1],arguments[2]);break;default:for(r=arguments.length,o=new Array(r-1),e=1;e<r;++e)o[e-1]=arguments[e];p.call(n,this,o)}},c={on:i,once:n,off:o,emit:s},f={on:a(i),once:a(n),off:a(o),emit:a(s)},u=v({},f),e.exports=r=function(t){return null==t?d(u):v(Object(t),f)},r.methods=c},{d:3,"es5-ext/object/valid-callable":12}],18:[function(t,e,r){function i(){}i.prototype={on:function(t,e,r){var i=this.e||(this.e={});return(i[t]||(i[t]=[])).push({fn:e,ctx:r}),this},once:function(t,e,r){function i(){n.off(t,i),e.apply(r,arguments)}var n=this;return i._=e,this.on(t,i,r)},emit:function(t){var e=[].slice.call(arguments,1),r=((this.e||(this.e={}))[t]||[]).slice(),i=0,n=r.length;for(i;i<n;i++)r[i].fn.apply(r[i].ctx,e);return this},off:function(t,e){var r=this.e||(this.e={}),i=r[t],n=[];if(i&&e)for(var o=0,s=i.length;o<s;o++)i[o].fn!==e&&i[o].fn._!==e&&n.push(i[o]);return n.length?r[t]=n:delete r[t],this}},e.exports=i},{}]},{},[1])(1)});