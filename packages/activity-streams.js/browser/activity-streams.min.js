!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).ActivityStreams=t()}}(function(){return function o(s,c,f){function u(e,t){if(!c[e]){if(!s[e]){var r="function"==typeof require&&require;if(!t&&r)return r(e,!0);if(a)return a(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var n=c[e]={exports:{}};s[e][0].call(n.exports,function(t){return u(s[e][1][t]||t)},n,n.exports,o,s,c,f)}return c[e].exports}for(var a="function"==typeof require&&require,t=0;t<f.length;t++)u(f[t]);return u}({1:[function(t,e,r){var i=t("event-emitter"),s=new(t("array-keys"))({identifier:"@id"}),c=i(),f=!1,u=[],n={stream:["@id","@type","actor","target","object","@context","context","published","error"],object:["@id","@type","@context","alias","attachedTo","attachment","attributedTo","attributedWith","content","context","contextOf","displayName","endTime","generator","generatorOf","icon","image","inReplyTo","memberOf","location","locationOf","objectOf","originOf","presence","preview","previewOf","provider","providerOf","published","rating","resultOf","replies","scope","scopeOf","startTime","status","summary","topic","tag","tagOf","targetOf","title","updated","url","titleMap","contentMap","members","message"]},a={},o={id:"@id",verb:"@type",objectType:"@type",platform:"context"},l={actor:{primary:"@id",props:n},target:{primary:"@id",props:n},object:{primary:"content",props:n}},p=Object.keys(l);function h(t,e){for(var r=Object.keys(e),i=r.length-1;0<=i;i-=1)if(n[t].indexOf(r[i])<0)if(o[r[i]])e[o[r[i]]]=e[r[i]],delete e[r[i]];else{if(e["@type"]&&"object"==typeof a[e["@type"]]&&0<=a[e["@type"]].indexOf(r[i]))continue;if(u.indexOf(e["@type"])<0)return'invalid property: "'+r[i]+'"'}return!1}function d(t){return t}var y=function(t){var e={},r=h("stream",t);if(r)throw new Error(r);if("object"==typeof t.object){if((r=h("object",t.object))&&f)throw new Error(r);r&&console.warn(r)}for(var i in t)if("string"==typeof t[i])e[i]=s.getRecord(t[i])||t[i];else if(Array.isArray(t[i]))for(e[i]=[],n=t[i].length-1;0<=n;n-=1)"string"==typeof t[i][n]&&(e[i][n]=s.getRecord(t[i][n])||t[i][n]);else e[i]=t[i];for(var n=p.length-1;0<=n;n-=1)if("string"==typeof e[p[n]]){var o={};o[l[p[n]].primary]=e[p[n]],e[p[n]]=o}return c.emit("activity-stream",e),e},v={create:function(t){var e=!1,r=h("object",t);if(r&&f)throw new Error(r);r&&console.warn(r),t=d(t);try{e=s.addRecord(t)}catch(t){throw new Error(t)}return e&&c.emit("activity-object-create",t),e},delete:function(t){var e=s.removeRecord(t);return e&&c.emit("activity-object-delete",t),e},get:function(t,e){var r=s.getRecord(t);if(!r){if(!e)return r;r={"@id":t}}return d(r)},list:function(){return s.getIdentifiers()},getByType:function(t){s.forEach(function(t){})}};e.exports=function(t){if("object"==typeof t&&(u=t.specialObjs||[],f=t.failOnUnknownObjectProperties||!1,"object"==typeof t.customProps))for(var e=Object.keys(t.customProps),r=0,i=e.length;r<i;r+=1)if("object"==typeof t.customProps[e[r]]){a[e[r]]=[];for(var n=0,o=t.customProps[e[r]].length;n<o;n+=1)a[e[r]].push(t.customProps[e[r]][n])}return{Stream:y,Object:v,on:function(t,e){return c.on(t,e)},once:function(t,e){return c.once(t,e)},off:function(t,e){return c.off(t,e)}}}},{"array-keys":2,"event-emitter":17}],2:[function(t,e,r){var i=t("tiny-emitter");function n(t){"object"!=typeof t&&(t={}),this._identifier=t.identifier||"id",this._store=[],this._idx=[],t.emitEvents?(this._emitEvents=!0,this.events=new i):this._emitEvents=!1}n.prototype.emitEvent=function(t,e,r){this._emitEvents&&!r&&this.events.emit(t,e)},n.prototype.getIdentifiers=function(){for(var t=[],e=this._store.length-1;0<=e;e-=1)t[t.length]=this._store[e][this._identifier];return t},n.prototype.getRecord=function(t){for(var e=this._store.length-1;0<=e;e-=1)if(this._store[e][this._identifier]===t)return this._store[e]},n.prototype.exists=function(t){return 0<=this.getIndex(t)},n.prototype.getIndex=function(t){for(var e=this._idx.length-1;0<=e;e-=1)if(this._idx[e]===t)return e;return-1},n.prototype.addRecord=function(t){if("object"!=typeof t)throw new Error("cannot add non-object records.");if(!t[this._identifier])throw new Error("cannot add a record with no `"+this._identifier+"` property specified.");var e=this.removeRecord(t[this._identifier],!0);return this._idx[this._idx.length]=t[this._identifier],this._store[this._store.length]=t,setTimeout(function(){e?setTimeout(this.emitEvent.bind(this,"update",t),0):setTimeout(this.emitEvent.bind(this,"add",t),0)}.bind(this),0),!0},n.prototype.removeRecord=function(t,e){var r=this.getIndex(t);if(r<0)return!1;for(var i=r;0<=i;i-=1)if(this._store[i]&&this._store[i][this._identifier]===t)return this._store.splice(i,1),this._idx.splice(r,1),setTimeout(this.emitEvent.bind(this,"remove",t,e),0),!0;for(var n=this._store.length-1;r<=n;n-=1)if(this._store[n]&&this._store[n][this._identifier]===t)return this._store.splice(n,1),this._idx.splice(r,1),setTimeout(this.emitEvent.bind(this,"remove",t,e),0),!0;return!1},n.prototype.forEachRecord=function(e){var r=0,i=this,n=function(){};return setTimeout(function(){for(var t=i._store.length-1;0<=t;t-=1)r+=1,setTimeout(e.bind(null,i._store[t],t),0);setTimeout(n.bind(null,r),0)},0),{finally:function(t){n=t}}},n.prototype.mapRecords=function(t){for(var e=[],r=this._store.length-1;0<=r;r-=1)1,e.push(t(this._store[r],r));return e},n.prototype.getCount=function(){return this._store.length},n.prototype.removeAll=function(){for(var t=this._store.length-1;0<=t;t-=1)delete this._store[t];this._store=[]},e.exports=n},{"tiny-emitter":18}],3:[function(t,e,r){"use strict";var c=t("es5-ext/object/assign"),f=t("es5-ext/object/normalize-options"),u=t("es5-ext/object/is-callable"),a=t("es5-ext/string/#/contains");(e.exports=function(t,e){var r,i,n,o,s;return arguments.length<2||"string"!=typeof t?(o=e,e=t,t=null):o=arguments[2],null==t?(r=n=!0,i=!1):(r=a.call(t,"c"),i=a.call(t,"e"),n=a.call(t,"w")),s={value:e,configurable:r,enumerable:i,writable:n},o?c(f(o),s):s}).gs=function(t,e,r){var i,n,o,s;return"string"!=typeof t?(o=r,r=e,e=t,t=null):o=arguments[3],null==e?e=void 0:u(e)?null==r?r=void 0:u(r)||(o=r,r=void 0):(o=e,e=r=void 0),n=null==t?!(i=!0):(i=a.call(t,"c"),a.call(t,"e")),s={get:e,set:r,configurable:i,enumerable:n},o?c(f(o),s):s}},{"es5-ext/object/assign":4,"es5-ext/object/is-callable":7,"es5-ext/object/normalize-options":11,"es5-ext/string/#/contains":14}],4:[function(t,e,r){"use strict";e.exports=t("./is-implemented")()?Object.assign:t("./shim")},{"./is-implemented":5,"./shim":6}],5:[function(t,e,r){"use strict";e.exports=function(){var t,e=Object.assign;return"function"==typeof e&&(e(t={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")}},{}],6:[function(t,e,r){"use strict";var s=t("../keys"),c=t("../valid-value"),f=Math.max;e.exports=function(e,r){var i,t,n,o=f(arguments.length,2);for(e=Object(c(e)),n=function(t){try{e[t]=r[t]}catch(t){i||(i=t)}},t=1;t<o;++t)r=arguments[t],s(r).forEach(n);if(void 0!==i)throw i;return e}},{"../keys":8,"../valid-value":13}],7:[function(t,e,r){"use strict";e.exports=function(t){return"function"==typeof t}},{}],8:[function(t,e,r){"use strict";e.exports=t("./is-implemented")()?Object.keys:t("./shim")},{"./is-implemented":9,"./shim":10}],9:[function(t,e,r){"use strict";e.exports=function(){try{return Object.keys("primitive"),!0}catch(t){return!1}}},{}],10:[function(t,e,r){"use strict";var i=Object.keys;e.exports=function(t){return i(null==t?t:Object(t))}},{}],11:[function(t,e,r){"use strict";var i=Array.prototype.forEach,n=Object.create;e.exports=function(t){var e=n(null);return i.call(arguments,function(t){null!=t&&function(t,e){var r;for(r in t)e[r]=t[r]}(Object(t),e)}),e}},{}],12:[function(t,e,r){"use strict";e.exports=function(t){if("function"!=typeof t)throw new TypeError(t+" is not a function");return t}},{}],13:[function(t,e,r){"use strict";e.exports=function(t){if(null==t)throw new TypeError("Cannot use null or undefined");return t}},{}],14:[function(t,e,r){"use strict";e.exports=t("./is-implemented")()?String.prototype.contains:t("./shim")},{"./is-implemented":15,"./shim":16}],15:[function(t,e,r){"use strict";var i="razdwatrzy";e.exports=function(){return"function"==typeof i.contains&&(!0===i.contains("dwa")&&!1===i.contains("foo"))}},{}],16:[function(t,e,r){"use strict";var i=String.prototype.indexOf;e.exports=function(t){return-1<i.call(this,t,arguments[1])}},{}],17:[function(t,e,r){"use strict";var n,i,o,s,c,f,u,a=t("d"),l=t("es5-ext/object/valid-callable"),p=Function.prototype.apply,h=Function.prototype.call,d=Object.create,y=Object.defineProperty,v=Object.defineProperties,m=Object.prototype.hasOwnProperty,_={configurable:!0,enumerable:!1,writable:!0};i=function(t,e){var r,i;return l(e),n.call(i=this,t,r=function(){o.call(i,t,r),p.call(e,this,arguments)}),r.__eeOnceListener__=e,this},c={on:n=function(t,e){var r;return l(e),m.call(this,"__ee__")?r=this.__ee__:(r=_.value=d(null),y(this,"__ee__",_),_.value=null),r[t]?"object"==typeof r[t]?r[t].push(e):r[t]=[r[t],e]:r[t]=e,this},once:i,off:o=function(t,e){var r,i,n,o;if(l(e),!m.call(this,"__ee__"))return this;if(!(r=this.__ee__)[t])return this;if("object"==typeof(i=r[t]))for(o=0;n=i[o];++o)n!==e&&n.__eeOnceListener__!==e||(2===i.length?r[t]=i[o?0:1]:i.splice(o,1));else i!==e&&i.__eeOnceListener__!==e||delete r[t];return this},emit:s=function(t){var e,r,i,n,o;if(m.call(this,"__ee__")&&(n=this.__ee__[t]))if("object"==typeof n){for(r=arguments.length,o=new Array(r-1),e=1;e<r;++e)o[e-1]=arguments[e];for(n=n.slice(),e=0;i=n[e];++e)p.call(i,this,o)}else switch(arguments.length){case 1:h.call(n,this);break;case 2:h.call(n,this,arguments[1]);break;case 3:h.call(n,this,arguments[1],arguments[2]);break;default:for(r=arguments.length,o=new Array(r-1),e=1;e<r;++e)o[e-1]=arguments[e];p.call(n,this,o)}}},f={on:a(n),once:a(i),off:a(o),emit:a(s)},u=v({},f),e.exports=r=function(t){return null==t?d(u):v(Object(t),f)},r.methods=c},{d:3,"es5-ext/object/valid-callable":12}],18:[function(t,e,r){function i(){}i.prototype={on:function(t,e,r){var i=this.e||(this.e={});return(i[t]||(i[t]=[])).push({fn:e,ctx:r}),this},once:function(t,e,r){var i=this;function n(){i.off(t,n),e.apply(r,arguments)}return n._=e,this.on(t,n,r)},emit:function(t){for(var e=[].slice.call(arguments,1),r=((this.e||(this.e={}))[t]||[]).slice(),i=0,n=r.length;i<n;i++)r[i].fn.apply(r[i].ctx,e);return this},off:function(t,e){var r=this.e||(this.e={}),i=r[t],n=[];if(i&&e)for(var o=0,s=i.length;o<s;o++)i[o].fn!==e&&i[o].fn._!==e&&n.push(i[o]);return n.length?r[t]=n:delete r[t],this}},e.exports=i},{}]},{},[1])(1)});