/* activity-streams.js v0.1.1 | (c) 2012-2014 Nick Jennings | License: MIT | https://github.com/silverbucket/activity-streams.js */
(function(w,undefined){var scope={};!function(t,i){"object"==typeof module&&"object"==typeof module.exports?module.exports=i(t.document?t:{}):i(t)}("undefined"!=typeof window?window:this,function(t,i){function e(t){"object"!=typeof t&&(t={}),this.identifier=t.identifier||"id",this.idx=[]}return e.prototype.getIdentifiers=function(){for(var t=[],i=this.idx.length-1;i>=0;i--)t.push(this.idx[i][this.identifier]);return t},e.prototype.getRecord=function(t){for(var e=this.idx.length-1;e>=0;e--)if(""+this.idx[e][this.identifier]==""+t)return this.idx[e];return i},e.prototype.addRecord=function(t){if("object"!=typeof t)throw new Error("cannot add non-object records.");if(!t[this.identifier])throw new Error("cannot add a record with no `"+this.identifier+"` property specified.");return this.removeRecord(t[this.identifier]),this.idx.push(t),!0},e.prototype.removeRecord=function(t){for(var i=this.idx.length-1;i>=0;i--)if(""+this.idx[i][this.identifier]==""+t)return this.idx.splice(i,1),!0;return!1},e.prototype.forEachRecord=function(t){for(var i=this.idx.length-1;i>=0;i--)t(this.idx[i])},e.prototype.getCount=function(){return this.idx.length},"function"==typeof define&&define.amd&&define([],function(){return e}),t.ArrayKeys=e,e});(function(){"use strict";function e(){}function t(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function n(e){return function(){return this[e].apply(this,arguments)}}var r=e.prototype,i=this,s=i.EventEmitter;r.getListeners=function(e){var t,n,r=this._getEvents();if(e instanceof RegExp){t={};for(n in r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n])}else t=r[e]||(r[e]=[]);return t},r.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},r.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},r.addListener=function(e,n){var r,i=this.getListenersAsObject(e),s="object"==typeof n;for(r in i)i.hasOwnProperty(r)&&-1===t(i[r],n)&&i[r].push(s?n:{listener:n,once:!1});return this},r.on=n("addListener"),r.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},r.once=n("addOnceListener"),r.defineEvent=function(e){return this.getListeners(e),this},r.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},r.removeListener=function(e,n){var r,i,s=this.getListenersAsObject(e);for(i in s)s.hasOwnProperty(i)&&(r=t(s[i],n),-1!==r&&s[i].splice(r,1));return this},r.off=n("removeListener"),r.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},r.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},r.manipulateListeners=function(e,t,n){var r,i,s=e?this.removeListener:this.addListener,o=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(r=n.length;r--;)s.call(this,t,n[r]);else for(r in t)t.hasOwnProperty(r)&&(i=t[r])&&("function"==typeof i?s.call(this,r,i):o.call(this,r,i));return this},r.removeEvent=function(e){var t,n=typeof e,r=this._getEvents();if("string"===n)delete r[e];else if(e instanceof RegExp)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this},r.removeAllListeners=n("removeEvent"),r.emitEvent=function(e,t){var n,r,i,s,o=this.getListenersAsObject(e);for(i in o)if(o.hasOwnProperty(i))for(r=o[i].length;r--;)n=o[i][r],n.once===!0&&this.removeListener(e,n.listener),s=n.listener.apply(this,t||[]),s===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},r.trigger=n("emitEvent"),r.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},r.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},r._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},r._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return i.EventEmitter=s,e},"function"==typeof define&&define.amd?define(function(){return e}):"object"==typeof module&&module.exports?module.exports=e:i.EventEmitter=e}).call(this);!function(e,t){if("object"==typeof module&&"object"==typeof module.exports){var r=require("array-keys"),n=require("wolfy87-eventemitter");module.exports=e.document?t(e,r,n):t({},r,n)}else{if(!e.ArrayKeys)throw new Error("activity-streams.js depends on the ArrayKeys module.");if(!e.EventEmitter)throw new Error("activity-streams.js depends on the EventEmitter module.");t(e,e.ArrayKeys,e.EventEmitter)}}("undefined"!=typeof window?window:this,function(e,t,r){var n=new t({identifier:"id"}),i=new t({identifier:"id"});ee=new r;var o={create:function(e){var t=!1;try{t=n.addRecord(e)}catch(r){throw new Error(r)}t&&ee.emitEvent("activity-stream-create",e)},"delete":function(e){var t=n.removeRecord(e);t&&ee.emitEvent("activity-stream-delete",e)},get:function(e){return n.getRecord(e)}},c={create:function(e){var t=!1;try{t=i.addRecord(e)}catch(r){throw new Error(r)}t&&ee.emitEvent("activity-object-create",e)},"delete":function(e){var t=i.removeRecord(e);t&&ee.emitEvent("activity-object-delete",e)},get:function(e){return i.getRecord(e)}};return"function"==typeof define&&define.amd&&define([],function(){return Activity}),e.Activity={Stream:o,Object:c,on:ee.on,once:ee.once,off:ee.off},e.Activity});w.Activity=scope.Activity;})(window);
